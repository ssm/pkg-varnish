#!/bin/bash
# 
# Braindead script to generate variables.vcl


TARGET=build/variables.vcl

if [ ! -f VARIABLES ]; then
	echo 1>&2 "No VARIABLES-file found. Bailing."
	exit 1;
fi

cat > $TARGET << __EOF__
/* Autogenerated with $0 at  $(date) 
 *
 * Do not modify, modify VARIABLES and rerun $0 instead.
 */

sub vcl_recv
{
__EOF__

grep -Ev '^(#.*|$)' VARIABLES | while read a; do
	echo "	unset req.http.$a;" >> $TARGET
done

echo "}" >> $TARGET
